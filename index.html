<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>렌터카 ERP 시스템</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/lucide-static@0.321.0/font/lucide.min.css" rel="stylesheet">
    <style>
        body { margin: 0; font-family: sans-serif; }
        @keyframes drawerAppear { 0% { transform: translateX(100%); } 100% { transform: translateX(0); } }
        .animate-drawer { animation: drawerAppear 0.3s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // 아이콘 컴포넌트 (Lucide 사용)
        const Icon = ({ name, size = 16, className = "" }) => (
            <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>
        );

        // [1] 구글 시트 웹 게시 URL
        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vREzDg6YIAoZBiSeT58g6sksXFZkILyX0hKJeuQIdfKxWDRgu7SX7epVkuKMjXvp8n10-sNCoWRyJdJ/pub?gid=1259006970&single=true&output=csv";

        // 상태 배지 컴포넌트
        const StatusBadge = ({ text, type }) => {
            if (!text) return null;
            let colorClass = "bg-slate-100 text-slate-600 border-slate-200";
            if (type === '구분') {
                if (text === '신차') colorClass = "bg-blue-50 text-blue-700 border-blue-100";
                else if (text === '중고') colorClass = "bg-slate-100 text-slate-700 border-slate-200";
            }
            return (
                <span className={`inline-flex items-center justify-center px-1.5 py-0.5 border text-[10px] font-black whitespace-nowrap ${colorClass}`}>
                    {text}
                </span>
            );
        };

        const App = () => {
            const [data, setData] = useState([]);
            const [searchTerm, setSearchTerm] = useState("");
            const [selectedCar, setSelectedCar] = useState(null);
            const [managerInfo, setManagerInfo] = useState({
                company: localStorage.getItem('erp_company') || '',
                nameTitle: localStorage.getItem('erp_name') || '',
                phone: localStorage.getItem('erp_phone') || ''
            });

            useEffect(() => {
                fetch(`${CSV_URL}&cachebust=${Date.now()}`)
                    .then(res => res.text())
                    .then(text => {
                        const rows = text.split(/\r?\n/).filter(r => r.trim());
                        const headers = rows[0].split(',').map(h => h.trim().replace(/"/g, ''));
                        const jsonData = rows.slice(1).map(row => {
                            const values = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v ? v.trim().replace(/^"|"$/g, '') : "");
                            return headers.reduce((obj, header, i) => { obj[header] = values[i] || ""; return obj; }, {});
                        });
                        setData(jsonData);
                        setTimeout(() => lucide.createIcons(), 100);
                    });
            }, []);

            const filteredData = useMemo(() => {
                return data.filter(item => Object.values(item).some(v => String(v).includes(searchTerm)));
            }, [searchTerm, data]);

            return (
                <div className="flex h-screen bg-[#f1f3f6] text-slate-900 overflow-hidden text-[11px]">
                    {/* 상단바 */}
                    <div className="flex-1 flex flex-col">
                        <header className="h-[50px] bg-white border-b flex items-center px-4 gap-4">
                            <input 
                                type="text" 
                                placeholder="매물 검색..." 
                                className="pl-4 pr-4 py-1.5 border rounded text-xs focus:outline-none w-64"
                                onChange={e => setSearchTerm(e.target.value)} 
                            />
                            <div className="ml-auto font-bold text-blue-600">매물: {filteredData.length}건</div>
                        </header>

                        {/* 메인 테이블 */}
                        <div className="flex-1 overflow-auto m-2 bg-white border">
                            <table className="w-full text-center table-fixed border-collapse">
                                <thead className="sticky top-0 bg-slate-50 border-b">
                                    <tr className="divide-x">
                                        <th className="py-2 w-16">상태</th>
                                        <th className="w-16">구분</th>
                                        <th className="w-24">차량번호</th>
                                        <th>모델명</th>
                                        <th className="w-20">주행거리</th>
                                        <th className="w-24 bg-blue-50 text-blue-700">24M 대여료</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y">
                                    {filteredData.map((item, i) => (
                                        <tr key={i} onClick={() => setSelectedCar(item)} className="hover:bg-blue-50 cursor-pointer h-10">
                                            <td><StatusBadge text={item.차량_상태} type="상태" /></td>
                                            <td><StatusBadge text={item.차량_구분} type="구분" /></td>
                                            <td className="font-bold">{item.차량_번호}</td>
                                            <td className="truncate text-left px-2 font-bold">{item.차량_모델명}</td>
                                            <td className="text-right pr-2">{item.차량_현재주행거리}km</td>
                                            <td className="text-blue-700 font-bold">{item.금액_대여료_24M}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {/* 우측 상세 정보 (섹션 5단계 유지) */}
                    {selectedCar && (
                        <div className="w-[400px] bg-white border-l shadow-xl flex flex-col animate-drawer">
                            <div className="p-4 border-b flex justify-between items-center bg-slate-50">
                                <b className="text-[12px]">상품 상세 정보</b>
                                <button onClick={() => setSelectedCar(null)} className="text-xl">×</button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-4">
                                <section className="border p-2 rounded">
                                    <b className="text-blue-600">1. 차량 상세 제원</b>
                                    <div className="mt-2">모델: {selectedCar.차량_모델명}</div>
                                    <div>번호: {selectedCar.차량_번호}</div>
                                </section>
                                <section className="border p-2 rounded">
                                    <b className="text-blue-600">2. 대여료 및 보증금</b>
                                    <div className="mt-2">24개월: {selectedCar.금액_대여료_24M} / {selectedCar.금액_보증금_24M}</div>
                                </section>
                                <section className="border p-2 rounded">
                                    <b className="text-blue-600">3. 보험 보상 상세</b>
                                    <div className="mt-2">자차면책금: {selectedCar.보험_최소면책금} ~ {selectedCar.보험_최대면책금}</div>
                                </section>
                                <section className="border p-2 rounded">
                                    <b className="text-blue-600">4. 계약 조건</b>
                                    <div className="mt-2">연령: {selectedCar.계약_기본운전연령} / 거리: {selectedCar.계약_약정주행거리}</div>
                                </section>
                                <section className="border p-2 rounded">
                                    <b className="text-blue-600">5. 담당자 정보</b>
                                    <div className="grid gap-2 mt-2">
                                        <input className="border p-1" placeholder="소속" value={managerInfo.company} onChange={e => setManagerInfo({...managerInfo, company: e.target.value})} />
                                        <input className="border p-1" placeholder="이름" value={managerInfo.nameTitle} onChange={e => setManagerInfo({...managerInfo, nameTitle: e.target.value})} />
                                    </div>
                                </section>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
</body>
</html>
