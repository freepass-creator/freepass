<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>프리패스 모빌리티 ERP</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        body { font-family: 'Pretendard', sans-serif; -webkit-font-smoothing: antialiased; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes drawerAppear { 0% { transform: translateX(100%); opacity: 0; } 100% { transform: translateX(0); opacity: 1; } }
        .animate-drawer-reset { animation: drawerAppear 0.3s cubic-bezier(0.1, 0.9, 0.2, 1) forwards; }
        .sidebar-elevation { box-shadow: 4px 0 15px rgba(0, 0, 0, 0.08), 1px 0 3px rgba(0, 0, 0, 0.1); }
        .btn-pressable { box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06); transition: all 0.12s cubic-bezier(0.4, 0, 0.2, 1); }
        .btn-pressable:hover { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.12), 0 2px 4px -1px rgba(0, 0, 0, 0.08); transform: translateY(-0.5px); }
        .btn-pressable:active { transform: translateY(1.5px); box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05); }
        .tactile-btn { box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1); transition: all 0.1s ease; }
        .tactile-btn:hover { background-color: #f8fafc; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08); }
        .tactile-btn-active { box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1) !important; transform: translateY(1px); }
        .natural-shadow { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05); }
        .apply-btn-shadow { box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.04); transition: all 0.1s ease; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Lucide 아이콘 브라우저 호환용 매핑
        const { 
          Search, X, RefreshCw, Download, Car, Shield, 
          FileText, User, CreditCard, ExternalLink, Database,
          ChevronRight, CheckCircle2, Copy, Filter,
          ArrowUpDown, ArrowUp, ArrowDown, Calendar, 
          Banknote, Coins, Gauge, History, Lock, Clock, CalendarDays,
          Info, Sparkles, AlertCircle, Phone, Wrench, Share2, RotateCw
        } = lucide;

        const { useState, useEffect, useMemo, useRef } = React;

        const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vREzDg6YIAoZBiSeT58g6sksXFZkILyX0hKJeuQIdfKxWDRgu7SX7epVkuKMjXvp8n10-sNCoWRyJdJ/pub?gid=1259006970&single=true&output=csv";

        const rentalOptions = ['50만 이하', '50~60', '60~70', '70~80', '80~90', '90~100', '100만 이상'];
        const depositOptions = ['100만 이하', '100~200', '200~300', '300~400', '400~500', '500만 이상'];
        const mileageOptions = ['1만km 미만', '1~3만', '3~5만', '5~10만', '10만km 이상'];
        const yearOptions = ['1년 이하', '1~3년', '3~5년', '5년 이상'];

        const StatusBadge = ({ text, type }) => {
          if (!text) return null;
          let colorClass = "bg-slate-100 text-slate-600 border-slate-200";
          if (type === '구분') {
            if (text === '신차') colorClass = "bg-blue-50 text-blue-700 border-blue-100";
            else if (text === '중고') colorClass = "bg-slate-100 text-slate-700 border-slate-200";
          } else if (type === '상태' || type === '세부상태') {
            const t = String(text);
            if (t.includes('가능') || t === '출고가능' || t === '정상') colorClass = "bg-emerald-50 text-emerald-700 border-emerald-100";
            else if (t.includes('완료') || t.includes('불가')) colorClass = "bg-rose-50 text-rose-700 border-rose-100";
            else colorClass = "bg-amber-50 text-amber-700 border-amber-100";
          }
          return (
            <span className={`inline-flex items-center justify-center px-1.5 py-0.5 border text-[10px] font-black leading-none whitespace-nowrap rounded-none ${colorClass}`}>
              {text}
            </span>
          );
        };

        // HTML 태그 렌더링 지원용
        const SafeHtml = ({ html }) => {
          if (!html || html === '-') return <span>정보 없음</span>;
          return <div dangerouslySetInnerHTML={{ __html: String(html).replace(/\n/g, '<br/>') }} />;
        };

        const App = () => {
          // --- [원본 모든 로직 및 변수 100% 동일] ---
          const [data, setData] = useState([]);
          const [loading, setLoading] = useState(true);
          const [isRefreshing, setIsRefreshing] = useState(false);
          const [searchTerm, setSearchTerm] = useState("");
          const [selectedCar, setSelectedCar] = useState(null);
          const [copyFeedback, setCopyFeedback] = useState(false);
          const [copyLinkFeedback, setCopyLinkFeedback] = useState(false);
          
          const [managerInfo, setManagerInfo] = useState({
            company: localStorage.getItem('erp_manager_company') || '',
            nameTitle: localStorage.getItem('erp_manager_nameTitle') || '',
            phone: localStorage.getItem('erp_manager_phone') || '',
            includeAccount: localStorage.getItem('erp_manager_includeAcc') === 'true'
          });

          const [selectedPeriods, setSelectedPeriods] = useState(['36M', '48M', '60M']); 
          const [columnFilters, setColumnFilters] = useState({}); 
          const [sortConfig, setSortConfig] = useState({ key: null, direction: 'desc' }); 
          
          const [sidebarFilters, setSidebarFilters] = useState({
            rental: [], deposit: [], mileage: [], year: []
          });
          
          const [activeFilterColumn, setActiveFilterColumn] = useState(null); 
          const [activeSidebarPopup, setActiveSidebarPopup] = useState(null); 
          
          const filterRef = useRef(null);
          const sidebarPopupRef = useRef(null);

          const parseNum = (str) => {
            if (!str) return 0;
            const val = parseInt(String(str).replace(/[^0-9]/g, ''));
            return isNaN(val) ? 0 : val;
          };

          const formatPrice = (val) => {
            const num = parseNum(val);
            return num.toLocaleString();
          };

          const formatPeriod = (p) => {
            if (!p) return "";
            return p.replace('M', '개월');
          };

          const handleSidebarPopupToggle = (id) => {
            if (activeSidebarPopup === id) setActiveSidebarPopup(null);
            else { setActiveFilterColumn(null); setActiveSidebarPopup(id); }
          };

          const handleColumnFilterToggle = (key) => {
            if (activeFilterColumn === key) setActiveFilterColumn(null);
            else { setActiveSidebarPopup(null); setActiveFilterColumn(key); }
          };

          const togglePeriod = (p) => {
            setSelectedPeriods(prev => {
              const periodsOrder = ['6M', '12M', '24M', '36M', '48M', '60M'];
              const next = prev.includes(p) ? (prev.length > 1 ? prev.filter(x => x !== p) : prev) : [...prev, p];
              return next.sort((a, b) => periodsOrder.indexOf(a) - periodsOrder.indexOf(b));
            });
          };

          const toggleSidebarFilter = (key, value) => {
            setSidebarFilters(prev => {
              const current = prev[key];
              const next = current.includes(value) ? current.filter(v => v !== value) : [...current, value];
              return { ...prev, [key]: next };
            });
          };

          const requestSort = (key) => {
            if (sortConfig.key === key) {
              setSortConfig({ key, direction: sortConfig.direction === 'desc' ? 'asc' : 'desc' });
            } else {
              setSortConfig({ key, direction: 'desc' });
            }
          };

          const handleCarClick = (car) => {
            if (selectedCar && selectedCar.차량_번호 === car.차량_번호) setSelectedCar(null);
            else { setSelectedCar(car); setCopyFeedback(false); setCopyLinkFeedback(false); }
          };

          const fetchData = async () => {
            setLoading(true); setIsRefreshing(true);
            try {
              const response = await fetch(`${CSV_URL}&cachebust=${Date.now()}`);
              const text = await response.text();
              const rows = text.split(/\r?\n/).filter(r => r.trim());
              if (rows.length === 0) { setData([]); setLoading(false); setIsRefreshing(false); return; }
              const headers = rows[0].split(',').map(h => h.trim().replace(/"/g, ''));
              const jsonData = rows.slice(1).map(row => {
                const regex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/;
                const values = row.split(regex).map(v => v ? v.trim().replace(/^"|"$/g, '').replace(/""/g, '"') : "");
                return headers.reduce((obj, header, i) => { obj[header] = values[i] || ""; return obj; }, {});
              });
              setData(jsonData);
            } catch (e) { console.error(e); }
            setLoading(false); setTimeout(() => setIsRefreshing(false), 600);
          };

          const handleCopySummary = () => {
            if (!selectedCar) return;
            let text = `[상품 상세 정보]\n\n1. 차량 상세 제원\n■ 차량번호: ${selectedCar.차량_번호} (${selectedCar.차량_구분}/${selectedCar.차량_상태})\n■ 모델명: ${selectedCar.차량_제조사} ${selectedCar.차량_모델명} ${selectedCar.차량_세부모델}\n■ 세부트림: ${selectedCar.차량_세부트림}\n■ 선택옵션: ${selectedCar.차량_선택옵션 || '기본 사양'}\n■ 주요제원: ${selectedCar.차량_연료 || '-'} / ${selectedCar.차량_배기량 ? formatPrice(selectedCar.차량_배기량) + 'cc' : '-'} / ${formatPrice(selectedCar.차량_현재주행거리)}km\n■ 색상(내/외): ${selectedCar.차량_내부색상} / ${selectedCar.차량_외부색상}\n■ 실물사진확인: ${selectedCar.차량_사진링크 || '링크 정보 없음'}\n\n2. 대여료 및 보증금 안내 (부가세 포함)\n`;
            ['6M', '12M', '24M', '36M', '48M', '60M'].forEach(m => {
              const fee = selectedCar[`금액_대여료_${m}`];
              const dep = selectedCar[`금액_보증금_${m}`];
              if (fee && fee !== '-' && fee !== '0') text += `■ ${formatPeriod(m)}: 월 대여료 ${fee} / 보증금 ${dep}\n`;
            });
            text += `\n3. 보험 보상 상세\n■ 대인배상: ${selectedCar.보험_대인 || '무한'} (면책금: ${selectedCar.보험_대인면책금 || '0원'})\n■ 대물배상: ${selectedCar.보험_대물 || '1억원'} (면책금: ${selectedCar.보험_대물면책금 || '10만'})\n■ 자기신체: ${selectedCar.보험_자손 || '3천만'} (면책금: ${selectedCar.보험_자손면책금 || '없음'})\n■ 무보험차 상해: ${selectedCar.보험_무보험 || '2억원'} (면책금: ${selectedCar.보험_무보험면책금 || '없음'})\n■ 자기차량: 차량가액 한도 (면책금: 수리비 20%, ${selectedCar.보험_최소면책금 || '20만'}~${selectedCar.보험_최대면책금 || '50만'})\n■ 면책금 할증: 1년 미만 운전자 면책금 30만원 추가 할증 적용\n■ 긴급출동: 연 5회 제공\n\n4. 계약 및 추가 비용 조건\n■ 기본연령: ${selectedCar.계약_기본운전연령 || '만 26세 이상'}\n■ 약정거리: ${selectedCar.계약_약정주행거리 || '2만km'}\n■ 해지위약: 중도해지 수수료율 30%\n■ 연령 하향(+): 만 21세(${parseNum(selectedCar.계약_21세추가금) > 0 ? formatPrice(selectedCar.계약_21세추가금) + '원' : '운영안함'}), 만 23세(${parseNum(selectedCar.계약_23세추가금) > 0 ? formatPrice(selectedCar.계약_23세추가금) + '원' : '운영안함'})\n■ 거리 추가(+): 1만km당 ${formatPrice(selectedCar.계약_주행거리추가금)}원/월\n\n5. 담당자 정보\n■ 소속/담당: ${managerInfo.company || '-'} ${managerInfo.nameTitle || '-'}\n■ 연락처: ${managerInfo.phone || '-'}\n`;
            if (managerInfo.includeAccount) text += `■ 입금계좌: ${selectedCar.계약_입금계좌번호 || '계좌 미등록'} (우리은행/프레패스)\n`;
            text += `\n* 본 정보는 내부 데이터로 실시간 상황에 따라 변동될 수 있습니다.`;
            const textArea = document.createElement("textarea"); textArea.value = text; document.body.appendChild(textArea); textArea.select();
            document.execCommand('copy'); setCopyFeedback(true); setTimeout(() => setCopyFeedback(false), 2000); document.body.removeChild(textArea);
          };

          const handleCopyLink = () => {
            const shareUrl = `${window.location.origin}${window.location.pathname}?car=${selectedCar.차량_번호}`;
            const textArea = document.createElement("textarea"); textArea.value = shareUrl; document.body.appendChild(textArea); textArea.select();
            document.execCommand('copy'); setCopyLinkFeedback(true); setTimeout(() => setCopyLinkFeedback(false), 2000); document.body.removeChild(textArea);
          };

          useEffect(() => { fetchData(); }, []);
          useEffect(() => {
            localStorage.setItem('erp_manager_company', managerInfo.company);
            localStorage.setItem('erp_manager_nameTitle', managerInfo.nameTitle);
            localStorage.setItem('erp_manager_phone', managerInfo.phone);
            localStorage.setItem('erp_manager_includeAcc', String(managerInfo.includeAccount));
          }, [managerInfo]);

          const filteredAndSortedData = useMemo(() => {
            let result = data.filter(item => {
              const ms = Object.values(item).some(v => String(v).toLowerCase().includes(searchTerm.toLowerCase()));
              const cf = Object.entries(columnFilters).every(([col, val]) => !val || val.length === 0 || val.includes(String(item[col])));
              let mr = !sidebarFilters.rental.length || sidebarFilters.rental.some(range => {
                const val = parseNum(item[`금액_대여료_${selectedPeriods[0] || '24M'}`]);
                if (range === '50만 이하') return val <= 500000;
                if (range === '100만 이상') return val >= 1000000;
                const [l, h] = range.split('~').map(s => parseInt(s) * 10000);
                return val >= l && val < h;
              });
              let md = !sidebarFilters.deposit.length || sidebarFilters.deposit.some(range => {
                const val = parseNum(item[`금액_보증금_${selectedPeriods[0] || '24M'}`]);
                if (range === '100만 이하') return val <= 1000000;
                if (range === '500만 이상') return val >= 5000000;
                const [l, h] = range.split('~').map(s => parseInt(s) * 10000);
                return val >= l && val < h;
              });
              let mm = !sidebarFilters.mileage.length || sidebarFilters.mileage.some(range => {
                const val = parseNum(item.차량_현재주행거리);
                if (range === '1만km 미만') return val < 10000;
                if (range === '10만km 이상') return val >= 100000;
                const [l, h] = range.split('~').map(s => parseInt(s) * 10000);
                return val >= l && val < h;
              });
              let my = true;
              if (sidebarFilters.year.length) {
                const rd = item.차량_최초등록일;
                if (!rd) my = false;
                else {
                  const now = new Date('2026-02-02'), reg = new Date(String(rd).replace(/\./g, '-'));
                  const ay = Math.abs(now - reg) / (1000 * 60 * 60 * 24 * 365);
                  my = sidebarFilters.year.some(r => {
                    if (r === '1년 이하') return ay <= 1;
                    if (r === '1~3년') return ay > 1 && ay <= 3;
                    if (r === '3~5년') return ay > 3 && ay <= 5;
                    return ay > 5;
                  });
                }
              }
              return ms && cf && mr && md && mm && my;
            });
            if (sortConfig.key) {
              result.sort((a, b) => {
                let av = a[sortConfig.key], bv = b[sortConfig.key];
                if (sortConfig.key === '차량_현재주행거리' || sortConfig.key.includes('금액')) { av = parseNum(av); bv = parseNum(bv); }
                return sortConfig.direction === 'asc' ? (av > bv ? 1 : -1) : (av < bv ? 1 : -1);
              });
            }
            return result;
          }, [searchTerm, data, columnFilters, sortConfig, sidebarFilters, selectedPeriods]);

          const baseColumns = { "상태": "차량_상태", "구분": "차량_구분", "차량번호": "차량_번호", "제조사": "차량_제조사", "모델": "차량_모델명", "세부모델": "차량_세부모델", "세부트림": "차량_세부트림", "내/외색상": "차량_외부색상", "주행거리": "차량_현재주행거리" };

          return (
            <div className="flex h-screen bg-[#f1f3f6] text-slate-900 overflow-hidden text-[11px] select-none">
              <div className="w-[72px] bg-white border-r flex flex-col items-center pt-[80px] gap-2 sidebar-elevation z-[60]">
                {['period', 'rental', 'deposit', 'mileage', 'year'].map(id => (
                  <button key={id} onClick={() => handleSidebarPopupToggle(id)} className={`w-[56px] h-[40px] border tactile-btn font-black uppercase ${activeSidebarPopup === id ? 'tactile-btn-active bg-slate-50 text-blue-700' : 'bg-white text-slate-700'}`}>
                    {id === 'period' ? '기간' : id === 'rental' ? '대여료' : id === 'deposit' ? '보증금' : id === 'mileage' ? '주행' : '연식'}
                  </button>
                ))}
              </div>

              <div className="flex-1 flex flex-col min-w-0">
                <header className="h-[50px] bg-white border-b flex items-center px-4 gap-4 z-20 shadow-sm">
                  <div className="relative flex-1 max-w-sm"><Search className="absolute left-2.5 top-2.5 text-slate-400" size={16}/><input type="text" placeholder="매물 통합 검색..." className="w-full pl-9 pr-4 py-2 border rounded-none text-xs outline-none" onChange={e => setSearchTerm(e.target.value)}/></div>
                  <div className="ml-auto flex items-center gap-4">
                    <span className="font-black">매물: <b className="text-blue-700">{filteredAndSortedData.length}</b>건</span>
                    <button onClick={fetchData} className="px-3 py-2 border font-bold hover:bg-slate-50 btn-pressable flex items-center gap-1"><RotateCw size={12} className={isRefreshing ? 'animate-spin' : ''}/> 최신화</button>
                  </div>
                </header>

                <div className="flex-1 overflow-auto bg-white">
                  <table className="w-full border-collapse text-center table-fixed">
                    <thead className="sticky top-0 bg-[#f8f9fb] border-b font-bold text-slate-600 uppercase tracking-tighter z-40">
                      <tr className="divide-x divide-slate-200">
                        {Object.keys(baseColumns).map(label => <th key={label} className="py-2 px-1">{label}</th>)}
                        {selectedPeriods.map(p => <th key={p} className="bg-blue-50 text-blue-800 w-[105px]">{formatPeriod(p)} 대여료</th>)}
                      </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-100">
                      {filteredAndSortedData.map((item, idx) => (
                        <tr key={idx} onClick={() => handleCarClick(item)} className={`hover:bg-slate-50 cursor-pointer h-[52px] ${selectedCar?.차량_번호 === item.차량_번호 ? 'bg-blue-50 font-bold' : ''}`}>
                          <td className="p-1"><StatusBadge text={item.차량_상태} type="상태"/></td>
                          <td className="p-1"><StatusBadge text={item.차량_구분} type="구분"/></td>
                          <td className="p-1 font-bold text-slate-900">{item.차량_번호}</td>
                          <td className="p-1">{item.차량_제조사}</td>
                          <td className="p-1 font-black truncate">{item.차량_모델명}</td>
                          <td className="p-1 text-left truncate">{item.차량_세부모델}</td>
                          <td className="p-1 text-left leading-none"><div className="truncate font-bold">{item.차량_세부트림}</div><div className="text-[9px] text-slate-400 truncate mt-1">{item.차량_선택옵션}</div></td>
                          <td className="p-1 truncate">{item.차량_외부색상}/{item.차량_내부색상}</td>
                          <td className="p-1 text-right pr-6 font-bold">{item.차량_현재주행거리}km</td>
                          {selectedPeriods.map(p => <td key={p} className="bg-blue-50/20 text-blue-800 font-black text-right pr-6 leading-none"><div>{item[`금액_대여료_${p}`]}</div><div className="text-[9px] text-slate-400 mt-1">{item[`금액_보증금_${p}`]}</div></td>)}
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>

                <div className={`fixed right-0 top-0 h-full w-[440px] bg-white natural-shadow z-[100] border-l transition-transform duration-300 ${selectedCar ? 'translate-x-0 animate-drawer-reset' : 'translate-x-full'}`}>
                  {selectedCar && (
                    <div className="flex flex-col h-full">
                      <div className="h-[50px] flex justify-between items-center px-4 border-b bg-white">
                        <h2 className="font-black text-[12px] uppercase flex items-center gap-2 font-bold"><Car size={16}/> 상세 사양 정보</h2>
                        <button onClick={() => setSelectedCar(null)} className="text-slate-400 text-2xl">✕</button>
                      </div>
                      <div className="flex-1 overflow-y-auto p-3 space-y-3 bg-white">
                        <section className="border rounded-none shadow-sm font-bold">
                          <div className="bg-slate-50 px-3 py-2 border-b font-black text-slate-600 uppercase">1. 차량 상세 제원</div>
                          <div className="p-3 space-y-3 font-bold">
                            <div className="flex justify-between border-b pb-2"><span className="text-blue-700 font-black">{selectedCar.차량_번호}</span><div className="flex gap-1"><StatusBadge text={selectedCar.차량_구분} type="구분"/><StatusBadge text={selectedCar.차량_상태} type="상태"/></div></div>
                            <p>모델: {selectedCar.차량_제조사} {selectedCar.차량_모델명} {selectedCar.차량_세부모델}</p>
                            <div className="p-2.5 bg-slate-50 border border-slate-100"><SafeHtml html={selectedCar.차량_비고}/></div>
                            <button onClick={() => window.open(selectedCar.차량_사진링크, '_blank')} className="w-full py-2.5 bg-white border font-black text-[10px] apply-btn-shadow">차량 사진 확인 (링크)</button>
                          </div>
                        </section>
                        <section className="border rounded-none shadow-sm"><div className="bg-slate-50 px-3 py-2 border-b font-black text-slate-600 uppercase">2. 대여료 및 보증금 안내</div>
                          <table className="w-full text-center divide-y divide-slate-100 font-bold"><thead className="bg-[#f8f9fb] text-slate-500 font-bold uppercase"><tr className="divide-x"><th className="py-2">기간</th><th className="py-2">대여료</th><th className="py-2">보증금</th></tr></thead>
                          <tbody className="divide-y">
                            {['24M', '36M', '48M', '60M'].map(m => <tr key={m} className="divide-x hover:bg-slate-50"><td className="py-2 font-black">{formatPeriod(m)}</td><td className="py-2 text-blue-800 font-black text-right pr-4">{selectedCar[`금액_대여료_${m}`]}원</td><td className="py-2 text-slate-500 text-right pr-4">{selectedCar[`금액_보증금_${m}`]}원</td></tr>)}
                          </tbody></table></section>
                        <section className="border rounded-none shadow-sm"><div className="bg-slate-50 px-3 py-2 border-b font-black text-slate-600 uppercase">3. 보험 보상 정보</div>
                          <div className="p-3 font-black space-y-1.5 uppercase">
                            <div className="flex justify-between"><span>대인/대물</span><span>{selectedCar.보험_대인 || '무한'} / {selectedCar.보험_대물 || '1억'}</span></div>
                            <div className="flex justify-between text-rose-700"><span>자차 면책금</span><span>수리비 20% ({selectedCar.보험_최소면책금 || '20만'}~{selectedCar.보험_최대면책금 || '50만'})</span></div>
                          </div></section>
                        <section className="border rounded-none shadow-sm bg-amber-50/10"><div className="bg-slate-50 px-3 py-2 border-b font-black text-slate-600 uppercase">4. 계약 정책 및 유의사항</div>
                          <div className="p-3 bg-white border border-amber-50"><SafeHtml html={selectedCar.계약_비고}/></div></section>
                        <section className="border rounded-none shadow-sm pb-2"><div className="bg-slate-50 px-3 py-2 border-b font-black text-slate-600 uppercase">5. 담당자 및 입금 계좌</div>
                          <div className="p-3 space-y-2 font-bold">
                            <div className="grid grid-cols-2 gap-2"><input className="p-2 border font-bold" placeholder="소속" value={managerInfo.company} onChange={e=>setManagerInfo({...managerInfo, company:e.target.value})}/><input className="p-2 border font-bold" placeholder="담당자" value={managerInfo.nameTitle} onChange={e=>setManagerInfo({...managerInfo, nameTitle:e.target.value})}/></div>
                            <input className="w-full p-2 border font-bold" placeholder="연락처" value={managerInfo.phone} onChange={e=>setManagerInfo({...managerInfo, phone:e.target.value})}/>
                            {managerInfo.includeAccount && <div className="p-3 bg-blue-50 border border-blue-100 text-center font-black text-blue-800">계좌: {selectedCar.계약_입금계좌번호 || '미등록'}<p className="text-[9px] text-blue-400 mt-1 uppercase font-bold">우리은행 (예금주: 프레패스)</p></div>}
                          </div></section>
                      </div>
                      <div className="p-3 border-t bg-white grid grid-cols-2 gap-3 shadow-[0_-4px_12px_rgba(0,0,0,0.03)] z-50">
                        <button onClick={handleCopyLink} className={`py-3.5 font-black flex items-center justify-center gap-2 border apply-btn-shadow ${copyLinkFeedback ? 'bg-emerald-600 text-white' : 'bg-white'}`}> {copyLinkFeedback ? '복사됨' : '고객 링크'} </button>
                        <button onClick={handleCopySummary} className={`py-3.5 font-black flex items-center justify-center gap-2 border apply-btn-shadow ${copyFeedback ? 'bg-green-600 text-white' : 'bg-slate-800 text-white'}`}> {copyFeedback ? '복사됨' : '전달 텍스트'} </button>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>
